
# yaml-language-server: $schema=https://dv-flow.github.io/flow.dv.schema.json"

package:
  name: hdl_if.examples.call_sv_bfm
  with:
    sim:
      type: str 
      value: "vlt"
    debug:
      type: int
      value: 0

  tasks:
  - name: local-pythonpath
    uses: std.SetEnv
    desc: Adds example directory to PYTHONPATH
    with:
      prepend_path:
        PYTHONPATH: ${{ rootdir }}

  - name: defines
    uses: std.FileSet
    with:
      type: systemVerilogSource
      include: [defines.v]
  
  - name: api-gen-hvlsrc
    desc: Generates SV interface code for the SV/Python API
    uses: pyhdl-if.APIGenSV
    needs: [local-pythonpath]
    with:
      pkgname: call_sv_bfm_pkg
      modules: 
      - call_sv_bfm

  - name: example-hvlsrc
    desc: Sources for the example
    uses: std.FileSet 
    with:
      type: systemVerilogSource
      incdirs: ["."]
      include:
      - wb_init_bfm.sv
      - call_sv_bfm.sv

  - name: sim-img
    desc: Compiles/elaborates the simulation image
    uses: "hdlsim.${{ sim }}.SimImage"
    needs: 
    - defines
    - pyhdl-if.DpiLib
    - pyhdl-if.SvPkg
    - api-gen-hvlsrc
    - example-hvlsrc
    with:
      top: [call_sv_bfm]

  - name: sim-run
    desc: Runs simulation
    needs: [local-pythonpath, sim-img]
    uses: hdlsim.${{ sim }}.SimRun
    with:
      plusargs:
      - pyhdl.debug=${{ debug }}

